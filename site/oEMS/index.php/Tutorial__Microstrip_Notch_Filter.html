<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<meta name="generator" content="MediaWiki 1.15.1" />
		<meta name="keywords" content="Tutorial: Microstrip Notch Filter,AppCSXCAD,Tutorial: First Steps,Tutorials" />
		<link rel="shortcut icon" href="http://openems.de/index.php/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="http://openems.de/index.php/opensearch_desc.php" title="openEMS (en)" />
		<link title="Creative Commons" type="application/rdf+xml" href="http://openems.de/index.php/index.php?title=Tutorial:_Microstrip_Notch_Filter&amp;action=creativecommons" rel="meta" />
		<link rel="copyright" href="https://creativecommons.org/licenses/by-sa/3.0/deed.de" />
		<link rel="alternate" type="application/rss+xml" title="openEMS RSS Feed" href="http://openems.de/index.php/index.php?title=Special:RecentChanges&amp;feed=rss" />
		<link rel="alternate" type="application/atom+xml" title="openEMS Atom Feed" href="http://openems.de/index.php/index.php?title=Special:RecentChanges&amp;feed=atom" />
		<title>Tutorial: Microstrip Notch Filter - openEMS</title>
		<link rel="stylesheet" href="../skins/common/shared.css%3F207.css" type="text/css" media="screen" />
		<link rel="stylesheet" href="../skins/common/commonPrint.css%3F207.css" type="text/css" media="print" />
		<link rel="stylesheet" href="../skins/monobook/main.css%3F207.css" type="text/css" media="screen" />
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE50Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE55Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="/skins/monobook/IE60Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="/skins/monobook/IE70Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="http://openems.de/index.php/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="http://openems.de/index.php/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" media="print" />
		<link rel="stylesheet" href="http://openems.de/index.php/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" type="text/css" />
		<link rel="stylesheet" href="http://openems.de/index.php/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" type="text/css" />
		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?207"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type= "text/javascript">/*<![CDATA[*/
		var skin = "monobook";
		var stylepath = "/skins";
		var wgArticlePath = "/index.php/$1";
		var wgScriptPath = "";
		var wgScript = "/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "Tutorial:_Microstrip_Notch_Filter";
		var wgTitle = "Tutorial: Microstrip Notch Filter";
		var wgAction = "view";
		var wgArticleId = "39";
		var wgIsArticle = true;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 1160;
		var wgVersion = "1.15.1";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="../skins/common/wikibits.js%3F207"><!-- wikibits js --></script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="../skins/common/ajax.js%3F207"></script>
<style type="text/css">/*<![CDATA[*/
.source-matlab {line-height: normal;}
.source-matlab li, .source-matlab pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for matlab
 * CSS class: source-matlab, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (https://qbnz.com/highlighter/ and https://geshi.org/)
 * --------------------------------------
 */
.matlab.source-matlab .de1, .matlab.source-matlab .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.matlab.source-matlab  {font-family:monospace;}
.matlab.source-matlab .imp {font-weight: bold; color: red;}
.matlab.source-matlab li, .matlab.source-matlab .li1 {font-weight: normal; vertical-align:top;}
.matlab.source-matlab .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.matlab.source-matlab .li2 {font-weight: bold; vertical-align:top;}
.matlab.source-matlab .kw1 {color: #0000FF;}
.matlab.source-matlab .kw2 {color: #0000FF;}
.matlab.source-matlab .co1 {color: #228B22;}
.matlab.source-matlab .co2 {color:#A020F0;}
.matlab.source-matlab .br0 {color: #080;}
.matlab.source-matlab .sy0 {color: #080;}
.matlab.source-matlab .nu0 {color: #33f;}
.matlab.source-matlab .re0 {color: #33f;}
.matlab.source-matlab .ln-xtra, .matlab.source-matlab li.ln-xtra, .matlab.source-matlab div.ln-xtra {background-color: #ffc;}
.matlab.source-matlab span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "http://openems.de/index.php/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style>		<script type="text/javascript" src="http://openems.de/index.php/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook"><!-- site js --></script>
	<style type='text/css'> #turnkey-credit { font-family: Tahoma,Sans,Arial,Helvetica,Verdana,sans-serif; font-size: 11px; text-align: center; } #turnkey-credit a { text-decoration: none; } #turnkey-credit a:hover { text-decoration: underline; } </style></head>
<body class="mediawiki ltr ns-0 ns-subject page-Tutorial_Microstrip_Notch_Filter skin-monobook">
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 id="firstHeading" class="firstHeading">Tutorial: Microstrip Notch Filter</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From openEMS</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="Tutorial:_Microstrip_Notch_Filter.html#column-one">navigation</a>, <a href="Tutorial:_Microstrip_Notch_Filter.html#searchInput">search</a></div>			<!-- start content -->
			<ul>
<li><b>Download</b> the latest matlab file using gitweb: <a href="https://openems.de/gitweb/?p=openEMS.git;a=blob_plain;f=matlab/Tutorials/MSL_NotchFilter.m;hb=HEAD" class="external text" title="https://openems.de/gitweb/?p=openEMS.git;a=blob_plain;f=matlab/Tutorials/MSL_NotchFilter.m;hb=HEAD" rel="nofollow">MSL_NotchFilter.m</a></li>
<li><b>Simulation Time</b>: ~ 2 min</li>
</ul>
<div class="thumb tright">
<div class="thumbinner" style="width:402px;"><a href="File:MSL_NotchFilter_Geometry.svg.html" class="image" title="The filter geometry"><img alt="" src="../images/thumb/a/ae/MSL_NotchFilter_Geometry.svg/400px-MSL_NotchFilter_Geometry.svg.png" width="400" height="231" border="0" class="thumbimage" /></a>
<div class="thumbcaption">
<div class="magnify"><a href="File:MSL_NotchFilter_Geometry.svg.html" class="internal" title="Enlarge"><img src="../skins/common/images/magnify-clip.png" width="15" height="11" alt="" /></a></div>
The filter geometry</div>
</div>
</div>
<hr />
<p>We will cover in this tutorial:</p>
<ul>
<li>setup a microstrip line (MSL) and MSL port</li>
<li>apply an inhomogeneous mesh used for improved accuracy and simulation speed</li>
<li>calculate the S-Parameter of the filter</li>
</ul>
<table id="toc" class="toc" summary="Contents">
<tr>
<td>
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toclevel-1"><a href="Tutorial:_Microstrip_Notch_Filter.html#First_Steps"><span class="tocnumber">1</span> <span class="toctext">First Steps</span></a></li>
<li class="toclevel-1"><a href="Tutorial:_Microstrip_Notch_Filter.html#Matlab_Simulation_Script"><span class="tocnumber">2</span> <span class="toctext">Matlab Simulation Script</span></a></li>
<li class="toclevel-1"><a href="Tutorial:_Microstrip_Notch_Filter.html#Discussion"><span class="tocnumber">3</span> <span class="toctext">Discussion</span></a>
<ul>
<li class="toclevel-2"><a href="Tutorial:_Microstrip_Notch_Filter.html#Return_To_Tutorials_Index"><span class="tocnumber">3.1</span> <span class="toctext">Return To Tutorials Index</span></a></li>
</ul>
</li>
</ul>
</td>
</tr>
</table>
<script type="text/javascript">
//<![CDATA[
 if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } 
//]]>
</script>
<p><a name="First_Steps" id="First_Steps"></a></p>
<h2><span class="mw-headline">First Steps</span></h2>
<ul>
<li>Install and verify your openEMS installation: <a href="http://openems.de/index.php/Tutorial:_First_Steps.html" title="Tutorial: First Steps">Tutorial: First Steps</a></li>
</ul>
<p><a name="Matlab_Simulation_Script" id="Matlab_Simulation_Script"></a></p>
<h2><span class="mw-headline">Matlab Simulation Script</span></h2>
<ul>
<li><b>Start the script within an empty environment:</b></li>
</ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;">
<div class="matlab source-matlab">
<pre class="de1">
<span class="kw2">close</span> <span class="kw2">all</span>
<span class="kw2">clear</span>
<span class="kw2">clc</span>
</pre></div>
</div>
<ul>
<li><b>Setup the simulation &amp; geometrical parameter</b></li>
</ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;">
<div class="matlab source-matlab">
<pre class="de1">
physical_constants;
unit = 1e-6; <span class="co1">% specify everything in um</span>
MSL_length = <span class="nu0">50000</span>;
MSL_width = <span class="nu0">600</span>;
substrate_thickness = <span class="nu0">254</span>;
substrate_epr = <span class="nu0">3.66</span>;
stub_length = 12e3;
f_max = 7e9;
</pre></div>
</div>
<ul>
<li><b>Setup the FDTD parameter</b> including the excitation time signal and boundary conditions</li>
</ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;">
<div class="matlab source-matlab">
<pre class="de1">
FDTD = InitFDTD<span class="br0">(</span><span class="br0">)</span>;
FDTD = SetGaussExcite<span class="br0">(</span> FDTD, f_max/<span class="nu0">2</span>, f_max/<span class="nu0">2</span> <span class="br0">)</span>;
BC   = <span class="br0">{</span><span class="co2">'PML_8'</span> <span class="co2">'PML_8'</span> <span class="co2">'MUR'</span> <span class="co2">'MUR'</span> <span class="co2">'PEC'</span> <span class="co2">'MUR'</span><span class="br0">}</span>;
FDTD = SetBoundaryCond<span class="br0">(</span> FDTD, BC <span class="br0">)</span>;
</pre></div>
</div>
<ul>
<li><b>Setup the inhomogeneous FDTD mesh</b>, including an improved handling of the thin metal edges by using two mesh lines, one line is located 1/3 inside and the other one 2/3 outside of the thin metal.</li>
</ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;">
<div class="matlab source-matlab">
<pre class="de1">
CSX = InitCSX<span class="br0">(</span><span class="br0">)</span>;
resolution = c0/<span class="br0">(</span>f_max*<span class="kw2">sqrt</span><span class="br0">(</span>substrate_epr<span class="br0">)</span><span class="br0">)</span>/unit /<span class="nu0">50</span>; <span class="co1">% resolution of lambda/50</span>
<span class="kw2">mesh</span>.<span class="me1">x</span> = SmoothMeshLines<span class="br0">(</span> <span class="br0">[</span><span class="nu0">0</span> MSL_width/<span class="nu0">2</span>+<span class="br0">[</span>resolution/<span class="nu0">3</span> -resolution/<span class="nu0">3</span>*<span class="nu0">2</span><span class="br0">]</span>/<span class="nu0">4</span><span class="br0">]</span>, resolution/<span class="nu0">4</span>, <span class="nu0">1.5</span> ,<span class="nu0">0</span> <span class="br0">)</span>;
<span class="kw2">mesh</span>.<span class="me1">x</span> = SmoothMeshLines<span class="br0">(</span> <span class="br0">[</span>-MSL_length -<span class="kw2">mesh</span>.<span class="me1">x</span> <span class="kw2">mesh</span>.<span class="me1">x</span> MSL_length<span class="br0">]</span>, resolution, <span class="nu0">1.5</span> ,<span class="nu0">0</span> <span class="br0">)</span>;
<span class="kw2">mesh</span>.<span class="me1">y</span> = SmoothMeshLines<span class="br0">(</span> <span class="br0">[</span><span class="nu0">0</span> MSL_width/<span class="nu0">2</span>+<span class="br0">[</span>-resolution/<span class="nu0">3</span> +resolution/<span class="nu0">3</span>*<span class="nu0">2</span><span class="br0">]</span>/<span class="nu0">4</span><span class="br0">]</span>, resolution/<span class="nu0">4</span> , <span class="nu0">1.5</span> ,<span class="nu0">0</span><span class="br0">)</span>;
<span class="kw2">mesh</span>.<span class="me1">y</span> = SmoothMeshLines<span class="br0">(</span> <span class="br0">[</span>-<span class="nu0">15</span>*MSL_width -<span class="kw2">mesh</span>.<span class="me1">y</span> <span class="kw2">mesh</span>.<span class="me1">y</span> <span class="nu0">15</span>*MSL_width+stub_length<span class="br0">]</span>, resolution, <span class="nu0">1.5</span> ,<span class="nu0">0</span><span class="br0">)</span>;
<span class="kw2">mesh</span>.<span class="me1">z</span> = SmoothMeshLines<span class="br0">(</span> <span class="br0">[</span><span class="kw2">linspace</span><span class="br0">(</span><span class="nu0">0</span>,substrate_thickness,<span class="nu0">5</span><span class="br0">)</span> <span class="nu0">10</span>*substrate_thickness<span class="br0">]</span>, resolution <span class="br0">)</span>;
CSX = DefineRectGrid<span class="br0">(</span> CSX, unit, <span class="kw2">mesh</span> <span class="br0">)</span>;
</pre></div>
</div>
<table>
<tr>
<td>
<div class="thumb tright">
<div class="thumbinner" style="width:402px;"><a href="File:Gridding-end-stub.png.html" class="image" title="Mesh at end of stub"><img alt="" src="../images/thumb/f/ff/Gridding-end-stub.png/400px-Gridding-end-stub.png" width="400" height="452" border="0" class="thumbimage" /></a>
<div class="thumbcaption">
<div class="magnify"><a href="File:Gridding-end-stub.png.html" class="internal" title="Enlarge"><img src="../skins/common/images/magnify-clip.png" width="15" height="11" alt="" /></a></div>
Mesh at end of stub</div>
</div>
</div>
</td>
<td>
<div class="thumb tright">
<div class="thumbinner" style="width:402px;"><a href="File:Gridding-T-junction.png.html" class="image" title="Mesh at T-junction"><img alt="" src="../images/thumb/1/19/Gridding-T-junction.png/400px-Gridding-T-junction.png" width="400" height="291" border="0" class="thumbimage" /></a>
<div class="thumbcaption">
<div class="magnify"><a href="File:Gridding-T-junction.png.html" class="internal" title="Enlarge"><img src="../skins/common/images/magnify-clip.png" width="15" height="11" alt="" /></a></div>
Mesh at T-junction</div>
</div>
</div>
</td>
</tr>
</table>
<ul>
<li><b>Add the MSL substrate</b></li>
</ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;">
<div class="matlab source-matlab">
<pre class="de1">
CSX = AddMaterial<span class="br0">(</span> CSX, <span class="co2">'RO4350B'</span> <span class="br0">)</span>;
CSX = SetMaterialProperty<span class="br0">(</span> CSX, <span class="co2">'RO4350B'</span>, <span class="co2">'Epsilon'</span>, substrate_epr <span class="br0">)</span>;
start = <span class="br0">[</span><span class="kw2">mesh</span>.<span class="me1">x</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>,   <span class="kw2">mesh</span>.<span class="me1">y</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>,   <span class="nu0">0</span><span class="br0">]</span>;
stop  = <span class="br0">[</span><span class="kw2">mesh</span>.<span class="me1">x</span><span class="br0">(</span><span class="kw1">end</span><span class="br0">)</span>, <span class="kw2">mesh</span>.<span class="me1">y</span><span class="br0">(</span><span class="kw1">end</span><span class="br0">)</span>, substrate_thickness<span class="br0">]</span>;
CSX = AddBox<span class="br0">(</span> CSX, <span class="co2">'RO4350B'</span>, <span class="nu0">0</span>, start, stop <span class="br0">)</span>;
</pre></div>
</div>
<table>
<tr>
<td>
<div class="thumb tright">
<div class="thumbinner" style="width:574px;"><a href="File:Gridding-z-direction.png.html" class="image" title="Mesh in the vertical direction"><img alt="" src="../images/8/8c/Gridding-z-direction.png" width="572" height="360" border="0" class="thumbimage" /></a>
<div class="thumbcaption">
<div class="magnify"><a href="File:Gridding-z-direction.png.html" class="internal" title="Enlarge"><img src="../skins/common/images/magnify-clip.png" width="15" height="11" alt="" /></a></div>
Mesh in the vertical direction</div>
</div>
</div>
</td>
</tr>
</table>
<ul>
<li><b>Add the two MSL ports</b></li>
</ul>
<p>It is important to note that the thru-line is not explicitly defined (as is the stub). Instead, the thru-line is formed by defining two ports which meet at x = 0. The z-coordinate of the metal layer is at <code>portstart(3)</code>.</p>
<p>These ports are terminated by PML boundary conditions on the -x and +x planes. Normally the measurement plane of a microstrip port is <code>(portstart(1) + portstop(1))/2</code> but in this case it is moved to <code>MSL_length/3</code>. Details of the ports are visible with CSXGeomPlot and by turning the PEC layer off, turning on voltage probes, and zooming in.</p>
<div dir="ltr" class="mw-geshi" style="text-align: left;">
<div class="matlab source-matlab">
<pre class="de1">
CSX = AddMetal<span class="br0">(</span> CSX, <span class="co2">'PEC'</span> <span class="br0">)</span>;
portstart = <span class="br0">[</span> <span class="kw2">mesh</span>.<span class="me1">x</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>, -MSL_width/<span class="nu0">2</span>, substrate_thickness<span class="br0">]</span>;
portstop  = <span class="br0">[</span> <span class="nu0">0</span>,  MSL_width/<span class="nu0">2</span>, <span class="nu0">0</span><span class="br0">]</span>;
<span class="br0">[</span>CSX,port<span class="br0">{</span><span class="nu0">1</span><span class="br0">}</span><span class="br0">]</span> = AddMSLPort<span class="br0">(</span> CSX, <span class="nu0">999</span>, <span class="nu0">1</span>, <span class="co2">'PEC'</span>, portstart, portstop, <span class="nu0">0</span>, <span class="br0">[</span><span class="nu0">0</span> <span class="nu0">0</span> -<span class="nu0">1</span><span class="br0">]</span>, <span class="sy0">...</span>
     <span class="co2">'ExcitePort'</span>, <span class="co2">'excite'</span>, <span class="co2">'FeedShift'</span>, <span class="nu0">10</span>*resolution, <span class="co2">'MeasPlaneShift'</span>,  MSL_length/<span class="nu0">3</span><span class="br0">)</span>;
 
portstart = <span class="br0">[</span><span class="kw2">mesh</span>.<span class="me1">x</span><span class="br0">(</span><span class="kw1">end</span><span class="br0">)</span>, -MSL_width/<span class="nu0">2</span>, substrate_thickness<span class="br0">]</span>;
portstop  = <span class="br0">[</span><span class="nu0">0</span>          ,  MSL_width/<span class="nu0">2</span>, <span class="nu0">0</span><span class="br0">]</span>;
<span class="br0">[</span>CSX,port<span class="br0">{</span><span class="nu0">2</span><span class="br0">}</span><span class="br0">]</span> = AddMSLPort<span class="br0">(</span> CSX, <span class="nu0">999</span>, <span class="nu0">2</span>, <span class="co2">'PEC'</span>, portstart, portstop, <span class="nu0">0</span>, <span class="br0">[</span><span class="nu0">0</span> <span class="nu0">0</span> -<span class="nu0">1</span><span class="br0">]</span>, 
    <span class="co2">'MeasPlaneShift'</span>,  MSL_length/<span class="nu0">3</span> <span class="br0">)</span>;
</pre></div>
</div>
<ul>
<li><b>Add the open-ended stub</b> with the given length</li>
</ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;">
<div class="matlab source-matlab">
<pre class="de1">
start = <span class="br0">[</span>-MSL_width/<span class="nu0">2</span>,  MSL_width/<span class="nu0">2</span>, substrate_thickness<span class="br0">]</span>;
stop  = <span class="br0">[</span> MSL_width/<span class="nu0">2</span>,  MSL_width/<span class="nu0">2</span>+stub_length, substrate_thickness<span class="br0">]</span>;
CSX = AddBox<span class="br0">(</span> CSX, <span class="co2">'PEC'</span>, <span class="nu0">999</span>, start, stop <span class="br0">)</span>;
</pre></div>
</div>
<ul>
<li><b>Create the simulation folder/ write the xml file/ View the file using <a href="http://openems.de/index.php/AppCSXCAD.html" title="AppCSXCAD">AppCSXCAD</a> and run openEMS</b></li>
</ul>
<div dir="ltr" class="mw-geshi" style="text-align: left;">
<div class="matlab source-matlab">
<pre class="de1">
Sim_Path = <span class="co2">'tmp'</span>;
Sim_CSX = <span class="co2">'msl.xml'</span>;
 
<span class="br0">[</span>status, message, messageid<span class="br0">]</span> = rmdir<span class="br0">(</span> Sim_Path, <span class="co2">'s'</span> <span class="br0">)</span>; <span class="co1">% clear previous directory</span>
<span class="br0">[</span>status, message, messageid<span class="br0">]</span> = <span class="kw2">mkdir</span><span class="br0">(</span> Sim_Path <span class="br0">)</span>; <span class="co1">% create empty simulation folder</span>
 
WriteOpenEMS<span class="br0">(</span> <span class="br0">[</span>Sim_Path <span class="co2">'/'</span> Sim_CSX<span class="br0">]</span>, FDTD, CSX <span class="br0">)</span>;
CSXGeomPlot<span class="br0">(</span> <span class="br0">[</span>Sim_Path <span class="co2">'/'</span> Sim_CSX<span class="br0">]</span> <span class="br0">)</span>;
RunOpenEMS<span class="br0">(</span> Sim_Path, Sim_CSX <span class="br0">)</span>;
</pre></div>
</div>
<ul>
<li><b>Do the post-processing</b>: Read the port voltages &amp; currents and calculate the port characteristics.</li>
</ul>
<div class="thumb tright">
<div class="thumbinner" style="width:402px;"><a href="File:MSL_NotchFilter_SPara.png.html" class="image" title="MSL Notch Filter S-Parameter"><img alt="" src="../images/thumb/c/c4/MSL_NotchFilter_SPara.png/400px-MSL_NotchFilter_SPara.png" width="400" height="300" border="0" class="thumbimage" /></a>
<div class="thumbcaption">
<div class="magnify"><a href="File:MSL_NotchFilter_SPara.png.html" class="internal" title="Enlarge"><img src="../skins/common/images/magnify-clip.png" width="15" height="11" alt="" /></a></div>
MSL Notch Filter S-Parameter</div>
</div>
</div>
<div dir="ltr" class="mw-geshi" style="text-align: left;">
<div class="matlab source-matlab">
<pre class="de1">
<span class="kw2">close</span> <span class="kw2">all</span>
f = <span class="kw2">linspace</span><span class="br0">(</span> 1e6, f_max, <span class="nu0">1601</span> <span class="br0">)</span>;
port = calcPort<span class="br0">(</span> port, Sim_Path, f, <span class="co2">'RefImpedance'</span>, <span class="nu0">50</span><span class="br0">)</span>;
 
s11 = port<span class="br0">{</span><span class="nu0">1</span><span class="br0">}</span>.<span class="me1">uf</span>.<span class="me1">ref</span>./ port<span class="br0">{</span><span class="nu0">1</span><span class="br0">}</span>.<span class="me1">uf</span>.<span class="me1">inc</span>;
s21 = port<span class="br0">{</span><span class="nu0">2</span><span class="br0">}</span>.<span class="me1">uf</span>.<span class="me1">ref</span>./ port<span class="br0">{</span><span class="nu0">1</span><span class="br0">}</span>.<span class="me1">uf</span>.<span class="me1">inc</span>;
 
<span class="kw2">plot</span><span class="br0">(</span>f/1e9,<span class="nu0">20</span>*<span class="kw2">log10</span><span class="br0">(</span><span class="kw2">abs</span><span class="br0">(</span>s11<span class="br0">)</span><span class="br0">)</span>,<span class="co2">'k-'</span>,<span class="co2">'LineWidth'</span>,<span class="nu0">2</span><span class="br0">)</span>;
<span class="kw2">hold</span> on;
<span class="kw2">grid</span> on;
<span class="kw2">plot</span><span class="br0">(</span>f/1e9,<span class="nu0">20</span>*<span class="kw2">log10</span><span class="br0">(</span><span class="kw2">abs</span><span class="br0">(</span>s21<span class="br0">)</span><span class="br0">)</span>,<span class="co2">'r--'</span>,<span class="co2">'LineWidth'</span>,<span class="nu0">2</span><span class="br0">)</span>;
<span class="kw2">legend</span><span class="br0">(</span><span class="co2">'S_{11}'</span>,<span class="co2">'S_{21}'</span><span class="br0">)</span>;
<span class="kw2">ylabel</span><span class="br0">(</span><span class="co2">'S-Parameter (dB)'</span>,<span class="co2">'FontSize'</span>,<span class="nu0">12</span><span class="br0">)</span>;
<span class="kw2">xlabel</span><span class="br0">(</span><span class="co2">'frequency (GHz) \rightarrow'</span>,<span class="co2">'FontSize'</span>,<span class="nu0">12</span><span class="br0">)</span>;
<span class="kw2">ylim</span><span class="br0">(</span><span class="br0">[</span>-<span class="nu0">40</span> <span class="nu0">2</span><span class="br0">]</span><span class="br0">)</span>;
</pre></div>
</div>
<p><br /></p>
<p><a name="Discussion" id="Discussion"></a></p>
<h2><span class="mw-headline">Discussion</span></h2>
<p>This simulation deliberately mis-aligned the mesh with the edges of the microstrip conductor. This can be seen in the images above showing the grid cells and the conducting layer. This is done to compensate for the peaking of the surface current at the edge of strip lines without having to resort to very small grid cells which would greatly increase the number of time steps required. With the 1/3&#160;: 2/3 grid offset the edge cells defining the microstrip line effectively increase the surface current while using a relatively coarse mesh.</p>
<p>This can be examined in some detail by removing the stub, adjusting the mesh, and comparing the characteristic impedance with a theoretical value.</p>
<p>In the first test the thirds mesh is compared with a uniform mesh that is aligned with the edges of the microstrip line, and a variable mesh which has narrow cells adjacent to the edge of the line. The characteristic impedance, calculated with <a href="https://transcalc.sourceforge.net/" class="external text" title="https://transcalc.sourceforge.net/" rel="nofollow">transcalc</a>, is 47.6 ohms. Note that the variable mesh took longer to simulate and yet was less accurate than the thirds meshing.</p>
<table class="wikitable" border="1">
<tr>
<th>Mesh type</th>
<th>Zc</th>
<th>Number cells</th>
<th>Time (sec)</th>
</tr>
<tr>
<td>Thirds</td>
<td>47.8</td>
<td>167k</td>
<td>16.6</td>
</tr>
<tr>
<td>Uniform aligned</td>
<td>44.0</td>
<td>161k</td>
<td>16.5</td>
</tr>
<tr>
<td>Variable</td>
<td>45.5</td>
<td>192k</td>
<td>32.4</td>
</tr>
</table>
<p><br />
The next test examines varying the ratio away from 1/3&#160;: 2/3. This shows that the ratio is not critical. Again, the theoretical value for Zc = 47.6 ohms.</p>
<table class="wikitable" border="1">
<tr>
<th>Ratio</th>
<th>Zc</th>
<th>Number cells</th>
<th>Time (sec)</th>
</tr>
<tr>
<td>1/3&#160;: 2/3</td>
<td>47.8</td>
<td>167k</td>
<td>16.6</td>
</tr>
<tr>
<td>0.4&#160;: 0.6</td>
<td>48.6</td>
<td>167k</td>
<td>16.7</td>
</tr>
<tr>
<td>1/4&#160;: 3/4</td>
<td>45.5</td>
<td>167k</td>
<td>16.3</td>
</tr>
</table>
<p><br />
Lastly, the influence of the dielectric is examined. In this test 1/3&#160;: 2/3 gridding was used, the dimensions of the microstrip line were unchanged, and the dielectric constant of the substrate was varied.</p>
<table class="wikitable" border="1">
<tr>
<th>eps_r</th>
<th>Zc (sim)</th>
<th>Zc (theory)</th>
<th>Number cells</th>
<th>Time (sec)</th>
</tr>
<tr>
<td>1</td>
<td>76.3</td>
<td>80.7</td>
<td>65k</td>
<td>12.4</td>
</tr>
<tr>
<td>3.66</td>
<td>47.8</td>
<td>47.6</td>
<td>167k</td>
<td>16.7</td>
</tr>
<tr>
<td>10</td>
<td>29.3</td>
<td>29.9</td>
<td>493k</td>
<td>93</td>
</tr>
</table>
<p>This effect is because errors from the edge current singularities are to first order (with respect to meshing) while errors are in general to the second order. For discussion, see for example: W. Heinrich, K. Beilenhoff, P. Mezzanotte and L. Roselli, "Optimum mesh grading for finite-difference method," in IEEE Trans. MTT, vol. 44, no. 9, pp. 1569-1574, Sep 1996. <a href="https://ieeexplore.ieee.org/document/536606/" class="external free" title="https://ieeexplore.ieee.org/document/536606/" rel="nofollow">https://ieeexplore.ieee.org/document/536606/</a></p>
<p>Discussion on the effective strip width can be found in: J.H. Oates, R.T. Shin, "Analytical Evaluation of Finite-Difference Time-Domain Transmission Line Properties," Progress In Electromagnetics Research, PIER 16, pp. 87--115,1997 <a href="https://www.jpier.org/PIER/pier16/04.960510p.Oates.S.pdf" class="external free" title="https://www.jpier.org/PIER/pier16/04.960510p.Oates.S.pdf" rel="nofollow">https://www.jpier.org/PIER/pier16/04.960510p.Oates.S.pdf</a></p>
<p>For discussion on applying the one-third two-thirds rule, see page 14 in: <a href="https://www.ate.uni-due.de/data/coft1/CoFT_EC_FDTD_Rennings.pdf" class="external free" title="https://www.ate.uni-due.de/data/coft1/CoFT_EC_FDTD_Rennings.pdf" rel="nofollow">https://www.ate.uni-due.de/data/coft1/CoFT_EC_FDTD_Rennings.pdf</a></p>
<p><a name="Return_To_Tutorials_Index" id="Return_To_Tutorials_Index"></a></p>
<h3><span class="mw-headline"><a href="http://openems.de/index.php/Tutorials.html" title="Tutorials">Return To Tutorials Index</a></span></h3>


<!-- 
NewPP limit report
Preprocessor node count: 32/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key wiki_db:pcache:idhash:39-0!1!0!!en!2!edit=0 and timestamp 20181110114351 -->
<div class="printfooter">
Retrieved from "<a href="Tutorial:_Microstrip_Notch_Filter.html">index.php/Tutorial:_Microstrip_Notch_Filter</a>"</div>
						<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div class="portlet" id="p-logo">
		<a style="background-image: url(../images/logo.png);" href="http://openems.de/index.php/Main_Page.html" title="Visit the main page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class='generated-sidebar portlet' id='p-navigation'>
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Front-Page"><a href="https://www.openEMS.de">Front Page</a></li>
				<li id="n-Wiki-Main-Page"><a href="http://openems.de/index.php/Main_Page.html">Wiki Main Page</a></li>
				<li id="n-Forum"><a href="https://www.openEMS.de/forum">Forum</a></li>
			</ul>
		</div>
	</div>
	<div class='generated-sidebar portlet' id='p-documentation'>
		<h5>documentation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-Installation"><a href="https://openems.de/index.php/OpenEMS#Installation">Installation</a></li>
				<li id="n-Tutorials"><a href="http://openems.de/index.php/Tutorials.html">Tutorials</a></li>
				<li id="n-Overview"><a href="http://openems.de/index.php/Overview.html">Overview</a></li>
				<li id="n-Online-Manual"><a href="Introduction.html">Online Manual</a></li>
				<li id="n-FAQ"><a href="Frequently_Asked_Questions.html">FAQ</a></li>
				<li id="n-Publications"><a href="http://openems.de/index.php/Publications.html">Publications</a></li>
			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-copyrightico"><a href="https://creativecommons.org/licenses/by-sa/3.0/deed.de"><img src="https://i.creativecommons.org/l/by-sa/3.0/de/88x31.png" alt='Creative Commons 3.0 (CC by-sa)' /></a></div>
			<ul id="f-list">
					<li id="lastmod"> This page was last modified on 20 July 2017, at 17:36.</li>
					<li id="viewcount">This page has been accessed 30,748 times.</li>
					<li id="copyright">Content is available under <a href="https://creativecommons.org/licenses/by-sa/3.0/deed.de" class="external " title="https://creativecommons.org/licenses/by-sa/3.0/deed.de">Creative Commons 3.0 (CC by-sa)</a>.</li>
					<li id="privacy"><a href="../start/index.php%3Fshow=privacy.html" title="openEMS:Privacy policy">Privacy policy</a></li>
					<li id="about"><a href="http://openems.de/index.php/index.php/openEMS:About" title="openEMS:About">About openEMS</a></li>
					<li id="privacy"><a href="../start/index.php%3Fshow=imprint.html" title="openEMS:Imprint">Imprint</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</body></html>
