<!DOCTYPE html>
<html dir="ltr" lang="en-gb">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Possible speed optimization for PEC? - openEMS.de</title>


	<link rel="canonical" href="viewtopic.php%3Ft=482.html">

<!--
	phpBB style name: prosilver
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:
-->

<link href="assets/css/font-awesome.min.css%3Fassets_version=3.css" rel="stylesheet">
<link href="styles/prosilver/theme/stylesheet.css%3Fassets_version=3.css" rel="stylesheet">
<link href="styles/prosilver/theme/en/stylesheet.css%3Fassets_version=3.css" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/prosilver/theme/tweaks.css?assets_version=3" rel="stylesheet">
<![endif]-->





</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">


<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description" class="site-description">
				<a id="logo" class="logo" href="index.php.html" title="Board index"><span class="site_logo"></span></a>
				<h1>openEMS.de</h1>
				<p>OpenEMS Support Forum</p>
				<p class="skiplink"><a href="viewtopic.php%3Fp=2848.html#start_here">Skip to content</a></p>
			</div>

									<div id="search-box" class="search-box search-header" role="search">
				<form action="http://openems.de/forum/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="http://openems.de/forum/search.php" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</div>
						
			</div>
					</div>
				<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="viewtopic.php%3Fp=2848.html#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="http://openems.de/forum/search.php?search_id=unanswered" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-gray" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="http://openems.de/forum/search.php?search_id=active_topics" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-blue" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="http://openems.de/forum/search.php" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
											<li class="separator"></li>
																			<li>
								<a href="memberlist.php%3Fmode=team.html" role="menuitem">
									<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
								</a>
							</li>
																<li class="separator"></li>

									</ul>
			</div>
		</li>

				<li data-skip-responsive="true">
			<a href="http://openems.de/forum/app.php/help/faq" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
						
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp.php%3Fmode=login.html" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
					<li class="rightside" data-skip-responsive="true">
				<a href="ucp.php%3Fmode=register.html" role="menuitem">
					<i class="icon fa-pencil-square-o  fa-fw" aria-hidden="true"></i><span>Register</span>
				</a>
			</li>
						</ul>

	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
						<li class="breadcrumbs">
										<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="index.php.html" itemprop="url" accesskey="h" data-navbar-reference="index"><i class="icon fa-home fa-fw"></i><span itemprop="title">Board index</span></a></span>

											<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="1"><a href="viewforum.php%3Ff=1.html" itemprop="url"><span itemprop="title">openEMS Support</span></a></span>
															<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="6"><a href="viewforum.php%3Ff=6.html" itemprop="url"><span itemprop="title">Development</span></a></span>
												</li>
		
					<li class="rightside responsive-search">
				<a href="http://openems.de/forum/search.php" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
			</ul>

	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		
<h2 class="topic-title"><a href="viewtopic.php%3Ff=6&amp;t=482.html">Possible speed optimization for PEC?</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Discussion about new features and development support<br /></div>
<p>
	<strong>Moderator:</strong> <a href="memberlist.php%3Fmode=viewprofile&amp;u=54.html" class="username">thorsten</a>
</p>


<div class="action-bar bar-top">
	
			<a href="posting.php%3Fmode=reply&amp;f=6&amp;t=482.html" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="http://openems.de/forum/viewtopic.php?f=6&amp;t=482&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="http://openems.de/forum/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="http://openems.de/forum/search.php" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="482" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			16 posts
							<ul>
		<li class="active"><span>1</span></li>
				<li><a class="button" href="viewtopic.php%3Ff=6&amp;t=482&amp;start=10.html" role="button">2</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopic.php%3Ff=6&amp;t=482&amp;start=10.html" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
		</div>




			<div id="p2831" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile2831">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist.php%3Fmode=viewprofile&amp;u=400.html" class="username">frankst</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="http://openems.de/forum/search.php?author_id=400&amp;sr=posts">32</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Thu 21 Jul 2016, 11:36</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content2831">

						<h3 class="first"><a href="viewtopic.php%3Fp=2848.html#p2831">Possible speed optimization for PEC?</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting.php%3Fmode=quote&amp;f=6&amp;p=2831.html" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic.php%3Fp=2831.html#p2831" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist.php%3Fmode=viewprofile&amp;u=400.html" class="username">frankst</a></strong> &raquo; </span>Thu 15 Jun 2017, 14:32
			</p>
			
			
			
			<div class="content">Hi Thorsten,<br>
<br>
Is it possible that openEMS always calculates fields for all cells, even the ones which are a priori known to be field free, e.g. cells within PEC?<br>
<br>
Wouldn't it be possible to exclude such cells from calculation?<br>
For example, during setup phase PEC cells which are fully surrounded by other PEC cells could be marked to be excluded from calculation.<br>
<br>
Cheers<br>
Frank</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="viewtopic.php%3Fp=2848.html#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p2835" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile2835">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist.php%3Fmode=viewprofile&amp;u=54.html" class="username">thorsten</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="http://openems.de/forum/search.php?author_id=54&amp;sr=posts">1221</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Mon 27 Jun 2011, 12:26</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content2835">

						<h3 ><a href="viewtopic.php%3Fp=2848.html#p2835">Re: Possible speed optimization for PEC?</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting.php%3Fmode=quote&amp;f=6&amp;p=2835.html" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic.php%3Fp=2835.html#p2835" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist.php%3Fmode=viewprofile&amp;u=54.html" class="username">thorsten</a></strong> &raquo; </span>Fri 16 Jun 2017, 08:24
			</p>
			
			
			
			<div class="content">Hello Frank,<br>
<br>
this could be done of course. But keep in mind any "if" clause inside the main engine is very computational expensive. Since the coefficients and fields are zero the CPU is very quick to decide the answer and I feel that it is faster to just run over it then have more complicated loops or (never do it) having if statements in your core.<br>
I even have cases where instead of an if clause I force a multiplication with zero instead, just because that is much faster...<br>
<br>
Speed optimization is not a trivial thing unfortunately...<br>
<br>
I hope I understood your question correctly...<br>
<br>
regards<br>
Thorsten</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="viewtopic.php%3Fp=2848.html#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p2836" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile2836">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist.php%3Fmode=viewprofile&amp;u=400.html" class="username">frankst</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="http://openems.de/forum/search.php?author_id=400&amp;sr=posts">32</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Thu 21 Jul 2016, 11:36</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content2836">

						<h3 ><a href="viewtopic.php%3Fp=2848.html#p2836">Re: Possible speed optimization for PEC?</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting.php%3Fmode=quote&amp;f=6&amp;p=2836.html" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic.php%3Fp=2836.html#p2836" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist.php%3Fmode=viewprofile&amp;u=400.html" class="username">frankst</a></strong> &raquo; </span>Fri 16 Jun 2017, 08:44
			</p>
			
			
			
			<div class="content">Hi Thorsten,<br>
<br>
I hope I understand your answer correctly <img class="smilies" src="images/smilies/icon_e_wink.gif" width="15" height="17" alt=";-)" title="Wink"><br>
<br>
I agree that an extra "if" would add to the computation time.<br>
But I wonder if skipping PEC cells should not reduce the amount of data that has to be read and written to the memory.<br>
And since memory bandwidth is the limit (not CPU speed), I would guess that an overall speed improvement would result.<br>
<br>
Cheers<br>
Frank</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="viewtopic.php%3Fp=2848.html#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p2837" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile2837">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist.php%3Fmode=viewprofile&amp;u=54.html" class="username">thorsten</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="http://openems.de/forum/search.php?author_id=54&amp;sr=posts">1221</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Mon 27 Jun 2011, 12:26</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content2837">

						<h3 ><a href="viewtopic.php%3Fp=2848.html#p2837">Re: Possible speed optimization for PEC?</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting.php%3Fmode=quote&amp;f=6&amp;p=2837.html" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic.php%3Fp=2837.html#p2837" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist.php%3Fmode=viewprofile&amp;u=54.html" class="username">thorsten</a></strong> &raquo; </span>Fri 16 Jun 2017, 09:05
			</p>
			
			
			
			<div class="content"><blockquote class="uncited"><div>But I wonder if skipping PEC cells </div></blockquote>
yes of course but how to skip if not asking for a flag with an if-variable?<br>
<br>
If you can skip complete mesh areas you should not mesh it in the first place, if it is inside the domain you need if-clauses? <br>
What do you have in mind on how to skip the cells without an (expensive) flag query?</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="viewtopic.php%3Fp=2848.html#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p2838" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile2838">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist.php%3Fmode=viewprofile&amp;u=400.html" class="username">frankst</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="http://openems.de/forum/search.php?author_id=400&amp;sr=posts">32</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Thu 21 Jul 2016, 11:36</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content2838">

						<h3 ><a href="viewtopic.php%3Fp=2848.html#p2838">Re: Possible speed optimization for PEC?</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting.php%3Fmode=quote&amp;f=6&amp;p=2838.html" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic.php%3Fp=2838.html#p2838" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist.php%3Fmode=viewprofile&amp;u=400.html" class="username">frankst</a></strong> &raquo; </span>Fri 16 Jun 2017, 09:36
			</p>
			
			
			
			<div class="content">Hi Thorsten,<br>
<br>
Since I have to cut out structures of different sizes from a block of PEC, I end up having a lot PEC within the meshed region.<br>
Certainly, I would prefer not to waste my mesh for PEC, but I haven't found a better solution.<br>
<br>
Of course, an "if" is required that checks for a flag.<br>
This flag could be created once during setup phase.<br>
During the simulation phase, querying this flag costs some CPU but might require less memory bandwidth then trying to calculate unnecessary fields.<br>
<br>
Obviously, the possible benefit (or drawback) depends on how openEMS loops over the mesh cells and how it accesses the stored fields per mesh cell.<br>
I tried to understand the code, but unfortunately I have not made a lot progress.<br>
May be you can give me a hint where to start?<br>
<br>
Edit:<br>
I am just speculating.<br>
Depending on the openEMS internals, it might be possible to completely remove unnecessary PEC cells from memory once the have been identified.<br>
No "if" required.<br>
But this really depends on how openEMS internally handles data.<br>
<br>
<br>
Cheers<br>
Frank</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="viewtopic.php%3Fp=2848.html#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p2840" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile2840">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist.php%3Fmode=viewprofile&amp;u=54.html" class="username">thorsten</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="http://openems.de/forum/search.php?author_id=54&amp;sr=posts">1221</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Mon 27 Jun 2011, 12:26</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content2840">

						<h3 ><a href="viewtopic.php%3Fp=2848.html#p2840">Re: Possible speed optimization for PEC?</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting.php%3Fmode=quote&amp;f=6&amp;p=2840.html" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic.php%3Fp=2840.html#p2840" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist.php%3Fmode=viewprofile&amp;u=54.html" class="username">thorsten</a></strong> &raquo; </span>Sat 17 Jun 2017, 19:13
			</p>
			
			
			
			<div class="content"><blockquote class="uncited"><div>During the simulation phase, querying this flag costs some CPU but might require less memory bandwidth then trying to calculate unnecessary fields.</div></blockquote>
It's not that simple I fear. Any if clause is expensive because the compiler does not know in advance what he is going to need. Thus clearing the cache and reloading memory every single time.<br>
Additionally openEMS uses SSE, that is doing 4 cells at once. Furthermore, a careful memory alignment is important such that larger chunks of memory are copied at once. Would some of these not be needed it would just mess up everything or at least do not help at all... I'm not saying that there is no room for improvement (there is a lot) and I know quite of few of them, but they are all not that simple...<br>

<blockquote class="uncited"><div>
Depending on the openEMS internals, it might be possible to completely remove unnecessary PEC cells from memory once the have been identified.</div></blockquote>
openEMS uses internally a simple 3D array to avoid any wired jumping around in memory. Adding holes etc is a bad idea (see above).<br>
Believe me, it is faster and more efficient to just run over the PEC cells, anything else just hurts the speed. <br>
There are other options to improve the speed. E.g. moving to AVX2 (instead of SSE), doing E+H update at once not as two steps, multiple time-stepping, any many more.<br>
But only the first one would be really an options as all the other would most likely just destroy the whole concept of the engine and its engine extensions...<br>
Another route could be to use a GPU-FDTD, but that again would require a complete rewrite of all engines and extensions... <br>
I just do not have the resources (read: time) for something like that...<br>
<br>
If speed is really important for you, check out <a href="http://empire.de/page236.html&amp;sid=fa8ffd5068759884b347a3027b619a5e" class="postlink">Empire XPU</a>  <img class="smilies" src="images/smilies/icon_e_wink.gif" width="15" height="17" alt=";)" title="Wink"> <br>
<br>
openEMS was designed with flexibility and ease of maintenance in mind. I was able to achieve both. Speed was only third (or less) priority. <br>
I did as much as I could come up with, but I always made sure it does not get in the way of flexibility and good code maintainability.  <br>
Going for as much speed as you can get (at any cost) is just not compatible with that goals I feel. <br>
But again, if anyone has good ideas how to improve the speed without sacrificing the primaries goals, keep the ideas coming  <img class="smilies" src="images/smilies/icon_e_wink.gif" width="15" height="17" alt=";)" title="Wink"> <br>
<br>
best regards<br>
Thorsten</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="viewtopic.php%3Fp=2848.html#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p2841" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile2841">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist.php%3Fmode=viewprofile&amp;u=54.html" class="username">thorsten</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="http://openems.de/forum/search.php?author_id=54&amp;sr=posts">1221</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Mon 27 Jun 2011, 12:26</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content2841">

						<h3 ><a href="viewtopic.php%3Fp=2848.html#p2841">Re: Possible speed optimization for PEC?</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting.php%3Fmode=quote&amp;f=6&amp;p=2841.html" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic.php%3Fp=2841.html#p2841" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist.php%3Fmode=viewprofile&amp;u=54.html" class="username">thorsten</a></strong> &raquo; </span>Sat 17 Jun 2017, 19:28
			</p>
			
			
			
			<div class="content"><blockquote class="uncited"><div>I tried to understand the code, but unfortunately I have not made a lot progress.<br>
May be you can give me a hint where to start?</div></blockquote>

There are multiple engines (with different level of optimization) and complexity:<br>
<br>
Simple Engine:<br>
(a very basic and simple engine, easy to understand, good for testing/implementing new features)<br>
<a href="https://github.com/thliebig/openEMS/blob/master/FDTD/engine.cpp#L108" class="postlink">https://github.com/thliebig/openEMS/blo ... e.cpp#L108</a><br>
<br>
SSE Engine:<br>
(using SSE CPU instructions)<br>
<a href="https://github.com/thliebig/openEMS/blob/master/FDTD/engine_sse.cpp#L75" class="postlink">https://github.com/thliebig/openEMS/blo ... se.cpp#L75</a><br>
<br>
Compressed SSE Engine:<br>
(using a compressed set of coefficients to save memory,  e.g. all PEC coefficients thus exist only once)<br>
<a href="https://github.com/thliebig/openEMS/blob/master/FDTD/engine_sse_compressed.cpp#L40" class="postlink">https://github.com/thliebig/openEMS/blo ... ed.cpp#L40</a><br>
<br>
Compressed Multi-threading SSE Engine:<br>
(This one just uses the "compressed SSE engine" in partial areas and syncs everything properly...)<br>
<a href="https://github.com/thliebig/openEMS/blob/master/FDTD/engine_multithread.cpp" class="postlink">https://github.com/thliebig/openEMS/blo ... thread.cpp</a><br>
<br>
By default the last one is used. And I doubt that anyone uses the other ones any more. But they can be handy if you test new features...<br>
If you want to you could have a look how to replace the SSE with AVX or even AVX2. But that would need to be optional as not all (older) CPU's support AVX(2)...<br>
<br>
regards<br>
Thorsten</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="viewtopic.php%3Fp=2848.html#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p2843" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile2843">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist.php%3Fmode=viewprofile&amp;u=400.html" class="username">frankst</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="http://openems.de/forum/search.php?author_id=400&amp;sr=posts">32</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Thu 21 Jul 2016, 11:36</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content2843">

						<h3 ><a href="viewtopic.php%3Fp=2848.html#p2843">Re: Possible speed optimization for PEC?</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting.php%3Fmode=quote&amp;f=6&amp;p=2843.html" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic.php%3Fp=2843.html#p2843" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist.php%3Fmode=viewprofile&amp;u=400.html" class="username">frankst</a></strong> &raquo; </span>Tue 20 Jun 2017, 09:32
			</p>
			
			
			
			<div class="content">Hi Thorsten,<br>
<br>
Thank you for the explanations and for pointing out where to look in the code.<br>
<br>
Cheers<br>
Frank</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="viewtopic.php%3Fp=2848.html#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p2847" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile2847">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist.php%3Fmode=viewprofile&amp;u=400.html" class="username">frankst</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="http://openems.de/forum/search.php?author_id=400&amp;sr=posts">32</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Thu 21 Jul 2016, 11:36</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content2847">

						<h3 ><a href="viewtopic.php%3Fp=2848.html#p2847">Re: Possible speed optimization for PEC?</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting.php%3Fmode=quote&amp;f=6&amp;p=2847.html" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic.php%3Fp=2847.html#p2847" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist.php%3Fmode=viewprofile&amp;u=400.html" class="username">frankst</a></strong> &raquo; </span>Tue 27 Jun 2017, 12:31
			</p>
			
			
			
			<div class="content">Hi Thorsten,<br>
<br>
I had a look at the code.<br>
If I understand your engines correctly, in UpdateVoltages and UpdateCurrents you have three nested for loops cycling over the grid.<br>
You use "pos" for the three indices to get the correct cell within the 3d mesh. Correct?<br>
But what is "shift" in UpdateVoltages?<br>
For example, you set "shift[2]=pos[2]".<br>
And a few lines later you use pos[2]-shift[2] as index.<br>
Shouldn't that always result index 0?<br>
<br>
Cheers<br>
Frank<br>
<br>
Edit: O.k., I just saw that "shift" is a bool.<br>
So, it effectively takes only values 0 and 1, right?<br>
But I still do not fully get what you do with it.<br>
I guess some averaging over neighboring cells.<br>
But in this case shouldn't shift be -1 or 1?<br>
<br>
Edit2: I'm making progress <img class="smilies" src="images/smilies/icon_e_wink.gif" width="15" height="17" alt=";-)" title="Wink"><br>
Due to C++ rules, "shift" will be 1 if pos~=0, i.e. almost always.<br>
Only if pos=0, shift=0.</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="viewtopic.php%3Fp=2848.html#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p2848" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile2848">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist.php%3Fmode=viewprofile&amp;u=54.html" class="username">thorsten</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="http://openems.de/forum/search.php?author_id=54&amp;sr=posts">1221</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Mon 27 Jun 2011, 12:26</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content2848">

						<h3 ><a href="viewtopic.php%3Fp=2848.html#p2848">Re: Possible speed optimization for PEC?</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting.php%3Fmode=quote&amp;f=6&amp;p=2848.html" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic.php%3Fp=2848.html#p2848" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist.php%3Fmode=viewprofile&amp;u=54.html" class="username">thorsten</a></strong> &raquo; </span>Tue 27 Jun 2017, 19:21
			</p>
			
			
			
			<div class="content">Yes exactly. The engine needs the 4 values around the edge. In both orthogonal directions at pos[d] and pos[d]-1...<br>
<br>
But why am I doing it like this?  <img class="smilies" src="images/smilies/icon_e_wink.gif" width="15" height="17" alt=";)" title="Wink"></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="viewtopic.php%3Fp=2848.html#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="posting.php%3Fmode=reply&amp;f=6&amp;t=482.html" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="http://openems.de/forum/viewtopic.php?f=6&amp;t=482&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="viewtopic.php%3Ff=6&amp;t=482.html">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			16 posts
							<ul>
		<li class="active"><span>1</span></li>
				<li><a class="button" href="viewtopic.php%3Ff=6&amp;t=482&amp;start=10.html" role="button">2</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopic.php%3Ff=6&amp;t=482&amp;start=10.html" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum.php%3Ff=6.html" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “Development”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforum.php%3Ff=1.html" class="jumpbox-cat-link"> <span> openEMS Support</span></a></li>
																<li><a href="viewforum.php%3Ff=5.html" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; News</span></a></li>
																<li><a href="viewforum.php%3Ff=2.html" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Install</span></a></li>
																<li><a href="viewforum.php%3Ff=3.html" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Usage</span></a></li>
																<li><a href="viewforum.php%3Ff=4.html" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Feedback</span></a></li>
																<li><a href="viewforum.php%3Ff=6.html" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Development</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
									<span class="crumb"><a href="index.php.html" data-navbar-reference="index"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Board index</span></a></span>					</li>
		
				<li class="rightside">All times are <span title="UTC+2">UTC+02:00</span></li>
							<li class="rightside">
				<a href="http://openems.de/forum/ucp.php?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete cookies</span>
				</a>
			</li>
												<li class="rightside" data-last-responsive="true">
				<a href="memberlist.php%3Fmode=team.html" role="menuitem">
					<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
				</a>
			</li>
									<li class="rightside" data-last-responsive="true">
				<a href="memberlist.php%3Fmode=contactadmin.html" role="menuitem">
					<i class="icon fa-envelope fa-fw" aria-hidden="true"></i><span>Contact us</span>
				</a>
			</li>
			</ul>

	</div>
</div>

	<div class="copyright">
				<p class="footer-row">
			<span class="footer-copyright">Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited</span>
		</p>
						<p class="footer-row">
			<a class="footer-link" href="ucp.php%3Fmode=privacy.html" title="Privacy" role="menuitem">
				<span class="footer-link-text">Privacy</span>
			</a>
			|
			<a class="footer-link" href="ucp.php%3Fmode=terms.html" title="Terms" role="menuitem">
				<span class="footer-link-text">Terms</span>
			</a>
		</p>
					</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="viewtopic.php%3Fp=2848.html#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="viewtopic.php%3Fp=2848.html#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	</div>

<script type="text/javascript" src="assets/javascript/jquery.min.js%3Fassets_version=3"></script>
<script type="text/javascript" src="assets/javascript/core.js%3Fassets_version=3"></script>



<script src="styles/prosilver/template/forum_fn.js%3Fassets_version=3"></script>
<script src="styles/prosilver/template/ajax.js%3Fassets_version=3"></script>



</body>
</html>
